<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>qrcode.js 生成二维码</title>
    <url>/2020/03/09/index/</url>
    <content><![CDATA[<p>目前，扫一扫的应用广泛，越来越多的产品需要我们程序员展示二维码，下面介绍一下怎么生成链接的动态二维码。（总是想着怎么开始第一篇博客）</p>
<h2 id="下载一个插件js-（qrcode-js）"><a href="#下载一个插件js-（qrcode-js）" class="headerlink" title="下载一个插件js （qrcode.js）"></a>下载一个插件js （qrcode.js）</h2><h3 id="页面引入js"><a href="#页面引入js" class="headerlink" title="页面引入js"></a>页面引入js</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/qrcode.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="同时在页面上设置一个隐藏域，隐藏域的value放上二维码想展示的链接"><a href="#同时在页面上设置一个隐藏域，隐藏域的value放上二维码想展示的链接" class="headerlink" title="同时在页面上设置一个隐藏域，隐藏域的value放上二维码想展示的链接"></a>同时在页面上设置一个隐藏域，隐藏域的value放上二维码想展示的链接</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"url"</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">value</span>=<span class="string">"https://www.baidu.com/"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个链接如果很长的话需要先转成短地址，短地址的接口下篇文章再介绍。</p>
<h3 id="需要在js文件中新增一个function，如下"><a href="#需要在js文件中新增一个function，如下" class="headerlink" title="需要在js文件中新增一个function，如下"></a>需要在js文件中新增一个function，如下</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeCode</span> (<span class="params"></span>) </span>&#123;		</span><br><span class="line">	<span class="keyword">var</span> elText = <span class="built_in">document</span>.getElementById(<span class="string">"shareUrl"</span>);</span><br><span class="line">    <span class="keyword">if</span> (!elText.value) &#123;</span><br><span class="line">        alert(<span class="string">"Input a text"</span>);</span><br><span class="line">        elText.focus();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    qrcode.makeCode(elText.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>document.getElementById(“url”)，就是上面隐藏域的id。</p>
<h3 id="页面上写一个div，用来展示二维码"><a href="#页面上写一个div，用来展示二维码" class="headerlink" title="页面上写一个div，用来展示二维码"></a>页面上写一个div，用来展示二维码</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"qrbox"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"qrcode"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>插件会生成canvas和img两个标签，自动加到到qrcode中。</p>
<h3 id="最后一步添加页面初始化生成二维码"><a href="#最后一步添加页面初始化生成二维码" class="headerlink" title="最后一步添加页面初始化生成二维码"></a>最后一步添加页面初始化生成二维码</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> qrcode = <span class="keyword">new</span> QRCode(<span class="built_in">document</span>.getElementById(<span class="string">"qrcode"</span>), &#123;</span><br><span class="line">        width: <span class="number">80</span>,</span><br><span class="line">        height: <span class="number">80</span></span><br><span class="line">    &#125;);</span><br><span class="line">    makeCode();</span><br><span class="line">    $(<span class="string">"#url"</span>).on(<span class="string">"blur"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        makeCode();</span><br><span class="line">    &#125;).on(<span class="string">"keydown"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e.keyCode == <span class="number">13</span>) &#123;</span><br><span class="line">            makeCode();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>我在使用过程中发现，部分安卓机二维码显示有问题特别小，并没有按照我们设置的css显示，经过不停地调试，我发现是安卓的环境下，生成的img标签display没有block出来，反而canvas标签block出来了。只要我们通过f12肯定会发现，正常的机子，都是img标签block，canvas标签是none。所以只要我们给canvas通过js动态的加上和img相同的class，或者相同的样式即可。具体代码如下，将原来的makeCode方法替换：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeCode</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> elText = <span class="built_in">document</span>.getElementById(<span class="string">"shareUrl"</span>);</span><br><span class="line">        <span class="keyword">if</span> (!elText.value) &#123;</span><br><span class="line">            alert(<span class="string">"Input a text"</span>);</span><br><span class="line">            elText.focus();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        qrcode.makeCode(elText.value);</span><br><span class="line">        $(<span class="string">"#qrcode img"</span>).addClass(<span class="string">"qrimg"</span>);</span><br><span class="line">        $(<span class="string">"#qrcode canvas"</span>).addClass(<span class="string">"qrimg"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>qrimg的样式，可根据自己实际展示效果写：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.qrbox .qrimg &#123;</span><br><span class="line">    color: #999;</span><br><span class="line">    font-size: 0.2rem;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    position: absolute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显示完美，所有机型都正常显示了，正当我们高兴的发布了，又有人发现，安卓机又出现问题了，简直就是开发的噩梦。。。<br>这次的问题是安卓机在微信环境下，没办法识别图中二维码，只能先截图，在识别图中的二维码，探索的过程不说了，最后是继续改造makeCode方法，见下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeCode</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> elText = <span class="built_in">document</span>.getElementById(<span class="string">"shareUrl"</span>);</span><br><span class="line">        <span class="keyword">if</span> (!elText.value) &#123;</span><br><span class="line">            alert(<span class="string">"Input a text"</span>);</span><br><span class="line">            elText.focus();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        qrcode.makeCode(elText.value);</span><br><span class="line">        $(<span class="string">"#qrcode img"</span>).addClass(<span class="string">"qrimg"</span>);</span><br><span class="line">        $(<span class="string">"#qrcode canvas"</span>).addClass(<span class="string">"qrimg"</span>);</span><br><span class="line">        <span class="keyword">if</span>(!$(<span class="string">"#qrcode img"</span>).attr(<span class="string">"src"</span>))&#123;</span><br><span class="line">            $(<span class="string">"#qrcode img"</span>).show();</span><br><span class="line">            $(<span class="string">"#qrcode canvas"</span>).hide();</span><br><span class="line">            <span class="keyword">var</span> canvas = $(<span class="string">"#qrcode canvas"</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> dataURL = canvas.toDataURL(<span class="string">"image/png"</span>);</span><br><span class="line">            $(<span class="string">"#qrcode img"</span>).attr(<span class="string">"src"</span>,dataURL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>将canvas转成img格式的base64码，到现在，一切ok。</p>
]]></content>
      <tags>
        <tag>第一篇</tag>
      </tags>
  </entry>
</search>
